
<!DOCTYPE html>
<html>
   <body>
   <h1>Web Bluetooth API access example</h1>
   <p>Scann for Estimote Proximity Beacons</p>
     
   <!-- JavaScript accessing Bluetooth -->
   
   <button type="button" onclick="onButtonClickByName()">Search for Beacon by name</button>
     
   <script>
      function onButtonClickByName() {
         
         <!-- Ask user for the permission for the Bluetooth access -->      
      
         button.addEventListener('pointerup', function(event) {
         
            <!-- Request Beacon by name -->     
         
            navigator.bluetooth.requestDevice({ filters: [{ name: "blue-beacon" }] })
            .then(device => { 
               log('> Name:             ' + device.name);
               log('> Id:               ' + device.id);
               log('> Connected:        ' + device.gatt.connected);
               document.getElementById("SearchByName").innerHTML = device.name;
            }) 
            .catch(error => { 
               console.log(error);
               document.getElementById("SearchByName").innerHTML = error;
            });
         }
      }
   </script>

   <p id="SearchByName">Result of the search by name</p>

   <button type="button" onclick="onButtonClickByUUID()">Search for Beacon by UUID</button>
      
   <script>
      function onButtonClickByUUID() {
         
         <!-- Request Beacon by UUID -->
         
         navigator.bluetooth.requestDevice({ filters: [{services: ['b9407f30-f5f8-466e-aff9-025556b57001'] }] })
         .then(device => { 
            log('> Name:             ' + device.name);
            log('> Id:               ' + device.id);
            log('> Connected:        ' + device.gatt.connected);
            document.getElementById("SearchByUuid").innerHTML = device.name;
         }) 
         .catch(error => { 
            console.log(error); 
            document.getElementById("SearchByUuid").innerHTML = error;
         });
      }     
   </script>
      
   <p id="SearchByUuid">Result of the search by UUID</p>      
         
   <button type="button" onclick="onButtonClick()">Search for Beacon using QuerySelector</button>
      
   <script>   
      function onButtonClick() {
         let filters = [];
         
         document.getElementById("SearchBySelector").innerHTML = "Query Selector Begin";

         let filterService = document.querySelector('#service').value;
         if (filterService.startsWith('0x')) {
            filterService = parseInt(filterService);
         }
         if (filterService) {
            filters.push({services: [filterService]});
         }

         let filterName = document.querySelector('#name').value;
         if (filterName) {
            filters.push({name: filterName});
         }

         let filterNamePrefix = document.querySelector('#namePrefix').value;
         if (filterNamePrefix) {
            filters.push({namePrefix: filterNamePrefix});
         }

         let options = {};
         if (document.querySelector('#allDevices').checked) {
            options.acceptAllDevices = true;
         } else {
            options.filters = filters;
         }

         log('Requesting Bluetooth Device...');
         log('with ' + JSON.stringify(options));
         navigator.bluetooth.requestDevice(options)
         .then(device => {
            log('> Name:             ' + device.name);
            log('> Id:               ' + device.id);
            log('> Connected:        ' + device.gatt.connected);
            document.getElementById("SearchBySelector").innerHTML = device.name;
         })
         .catch(error => { log('Argh! ' + error); });         
      }
   </script>   
      
   <p id="SearchBySelector">Result of the search by query selector</p>
     
   </body>
</html>

