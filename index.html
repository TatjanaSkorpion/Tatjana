
<!DOCTYPE html>
<html>
   <body>
   <h1>Web Bluetooth API access example</h1>
   <p>Scann for Estimote Proximity Beacons 2</p>
     
   <!-- JavaScript accessing Bluetooth -->
   
   <p>Search for Beacon by name</p>
   <p id="SearyByName">Result name</p>
      
   <script>     
      <!-- Ask user for the permission for the Bluetooth access -->      
      button.addEventListener('pointerup', function(event) {         
         <!-- Request Beacon by name -->     
         navigator.bluetooth.requestDevice({ filters: [{name: "blue-beacon"}] });
         .then(device => { 
            log('> Name:             ' + device.name);
            log('> Id:               ' + device.id);
            log('> Connected:        ' + device.gatt.connected);
            document.getElementById("SearchByName").innerHTML = device.name;
         }) 
         .catch(error => { console.log(error); });        
      });     
   </script>      

   <p >Search Beacon by UUID</p>
   <p id="SearchByUuid">Result name</p>
   <button type="button" onclick="onButtonClick()">Search for Beacon by UUID</button>
      
   <script>
      function onButtonClick() {
         <!-- Request Beacon by UUID -->     
         navigator.bluetooth.requestDevice({ filters: [{services: ['B9407F30-F5F8-466E-AFF9-025556B57001'] }] });
         .then(device => { 
            log('> Name:             ' + device.name);
            log('> Id:               ' + device.id);
            log('> Connected:        ' + device.gatt.connected);
            document.getElementById("SearchByUuid").innerHTML = device.name;
         }); 
         .catch(error => { console.log(error); });
      }     
   </script>  
      
   <p>Search for Beacon using querySelector</p>
   <p id="SearchBySelector">Result name</p>
      
   <button type="button" onclick="onButtonClick()">Search for Beacon using QuerySelector</button>
      
   <script>   
      function onButtonClick() {
         let filters = [];
         
         document.getElementById("SearchBySelector").innerHTML = "Query Selector Begin";

         let filterService = document.querySelector('#service').value;
         if (filterService.startsWith('0x')) {
            filterService = parseInt(filterService);
         }
         if (filterService) {
            filters.push({services: [filterService]});
         }

         let filterName = document.querySelector('#name').value;
         if (filterName) {
            filters.push({name: filterName});
         }

         let filterNamePrefix = document.querySelector('#namePrefix').value;
         if (filterNamePrefix) {
            filters.push({namePrefix: filterNamePrefix});
         }

         let options = {};
         if (document.querySelector('#allDevices').checked) {
            options.acceptAllDevices = true;
         } else {
            options.filters = filters;
         }

         log('Requesting Bluetooth Device...');
         log('with ' + JSON.stringify(options));
         navigator.bluetooth.requestDevice(options)
         .then(device => {
            log('> Name:             ' + device.name);
            log('> Id:               ' + device.id);
            log('> Connected:        ' + device.gatt.connected);
            document.getElementById("SearchBySelecto").innerHTML = device.name;
         })
         .catch(error => {
            log('Argh! ' + error);
         });         
      }     
   </script>   
     
   </body>
</html>

